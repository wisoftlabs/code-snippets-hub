# PostgreSQL 사용자 및 데이터베이스 생성 스크립트

이 Zsh 스크립트는 CSV 파일에 포함된 사용자 정보를 사용하여 PostgreSQL 사용자를 생성하고, 각 사용자에게 데이터베이스를 자동으로 생성해주는 스크립트입니다. CSV 파일의 각 줄에는 사용자 이름과 해당하는 데이터베이스 이름이 지정되어 있어야 합니다. 모든 사용자에게 동일한 비밀번호가 설정되며, 필요한 권한이 부여됩니다.

## 요구 사항

- **Zsh** 셸
- **PostgreSQL**가 대상 서버에 설치되어 있어야 함
- **`pgpass`** 파일을 사용하여 PostgreSQL 접속 정보를 저장 (자동 인증 처리)
- **SSH ProxyJump**를 통한 원격 서버 접속

## 파일 구조

- **`user-info.csv`**: 두 개의 열을 가진 CSV 파일:
    1. **사용자 이름**: 생성할 PostgreSQL 사용자 이름.
    2. **데이터베이스 이름**: 생성할 데이터베이스 이름이며, 해당 사용자가 소유하게 됨.

예시 파일 구조:
```bash
username1,dbname1 
username2,dbname2 ...
```

## 스크립트 설명

### 스크립트 경로: `create-user-and-db.sh`

스크립트는 다음의 과정을 수행합니다:

1. **CSV 파일**을 읽어들여 사용자와 데이터베이스 이름을 추출합니다.
2. 각 사용자를 PostgreSQL에 **생성**하고, 해당 사용자의 이름을 소유자로 하는 **데이터베이스**를 생성합니다.
3. 생성된 사용자에게 해당 데이터베이스에 대한 **생성 권한**을 부여합니다.

### 변수 설명:

- `CSV_FILE`: 사용자 정보를 담고 있는 CSV 파일 경로.
- `PGUSER`: PostgreSQL에 접속할 때 사용할 권한 있는 사용자 이름.
- `PGDB`: PostgreSQL에서 사용할 기본 데이터베이스.
- `PGHOST`: PostgreSQL 서버 주소.
- `PGPORT`: PostgreSQL 서버 포트.
- `USERPW`: 모든 학생들에게 부여할 통일된 비밀번호.

### 실행 방법

1. **CSV 파일**을 준비합니다. 각 줄에 "사용자 이름, 데이터베이스 이름" 형식으로 작성합니다.
2. **CSV 파일을 원격 서버로 복사**합니다. 아래의 `scp` 명령어를 사용하여 CSV 파일을 원격 서버로 전송합니다. 이때, SSH ProxyJump를 사용하여 중간 서버를 통해 연결합니다.

    ```bash
    scp [로컬 서버의 .csv 경로] sshProxyJumpHost:[원격 서버의 .sh 경로]
    ```

3. 원격 서버에 파일이 복사되면, 스크립트를 실행합니다.

    ```bash
    ./create-user-and-db.sh
    ```

### 주의 사항

- `pgpass` 파일을 적절히 설정해야 비밀번호 없이 자동으로 PostgreSQL에 접속할 수 있습니다. `pgpass` 파일 경로는 `/home/postgres/.pgpass`로 설정되어 있습니다.
- 모든 사용자의 비밀번호는 스크립트 내의 `USERPW` 변수에 지정된 비밀번호로 설정됩니다.
